<!-- vendors/templates/vendors/stock_offers.html -->
{% extends 'vendors/base.html' %}

{% block title %}Stock Offers - BookStore{% endblock %}

{% block extra_css %}
<style>
    .filters-section {
        background: rgba(255, 255, 255, 0.8);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 25px;
    }
    .filter-pills {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 15px;
    }
    .filter-pill {
        padding: 8px 16px;
        background: rgba(102, 126, 234, 0.1);
        border: 1px solid #667eea;
        border-radius: 20px;
        color: #667eea;
        text-decoration: none;
        font-size: 0.9rem;
        transition: all 0.3s ease;
    }
    .filter-pill:hover,
    .filter-pill.active {
        background: #667eea;
        color: white;
        text-decoration: none;
    }
    .offers-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    .offer-card {
        background: rgba(255, 255, 255, 0.9);
        border-radius: 15px;
        padding: 25px;
        border-left: 4px solid #667eea;
        transition: all 0.3s ease;
        position: relative;
    }
    .offer-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
    }
    .book-info {
        margin-bottom: 15px;
    }
    .book-title {
        font-size: 1.2rem;
        font-weight: 700;
        color: #333;
        margin-bottom: 5px;
        line-height: 1.3;
    }
    .book-authors {
        color: #666;
        font-size: 0.95rem;
    }
    .offer-details {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        margin-bottom: 15px;
    }
    .detail-item {
        text-align: center;
    }
    .detail-label {
        font-size: 0.8rem;
        color: #666;
        text-transform: uppercase;
        font-weight: 600;
        margin-bottom: 5px;
    }
    .detail-value {
        font-size: 1.1rem;
        font-weight: 700;
        color: #333;
    }
    .detail-value.price {
        color: #28a745;
    }
    .detail-value.quantity {
        color: #667eea;
    }
    .offer-dates {
        background: rgba(102, 126, 234, 0.05);
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 15px;
        font-size: 0.9rem;
    }
    .date-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 5px;
    }
    .date-row:last-child {
        margin-bottom: 0;
    }
    .date-label {
        color: #666;
        font-weight: 500;
    }
    .date-value {
        color: #333;
        font-weight: 600;
    }
    .status-section {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 20px;
        padding-top: 15px;
        border-top: 1px solid rgba(102, 126, 234, 0.1);
    }
    .status-badge {
        padding: 6px 12px;
        border-radius: 15px;
        font-size: 0.8rem;
        font-weight: 600;
    }
    .status-pending {
        background: #ffc107;
        color: #000;
    }
    .status-approved {
        background: #28a745;
        color: white;
    }
    .status-rejected {
        background: #dc3545;
        color: white;
    }
    .status-processed {
        background: #6c757d;
        color: white;
    }
    .offer-actions {
        display: flex;
        gap: 8px;
    }
    .action-btn {
        padding: 5px 10px;
        border-radius: 8px;
        text-decoration: none;
        font-size: 0.8rem;
        font-weight: 500;
        transition: all 0.3s ease;
    }
    .btn-view {
        background: rgba(102, 126, 234, 0.1);
        color: #667eea;
    }
    .btn-view:hover {
        background: #667eea;
        color: white;
    }
    .btn-edit {
        background: rgba(255, 193, 7, 0.1);
        color: #ffc107;
    }
    .btn-edit:hover {
        background: #ffc107;
        color: #000;
    }
    .admin-notes {
        background: rgba(255, 193, 7, 0.1);
        border: 1px solid #ffc107;
        border-radius: 8px;
        padding: 10px;
        margin-top: 10px;
        font-size: 0.9rem;
    }
    .admin-notes-label {
        font-weight: 600;
        color: #856404;
        margin-bottom: 5px;
    }
    .admin-notes-text {
        color: #856404;
        margin: 0;
    }
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #999;
    }
    .empty-state i {
        font-size: 4rem;
        margin-bottom: 20px;
        color: #667eea;
        opacity: 0.5;
    }
    .empty-state h4 {
        color: #666;
        margin-bottom: 15px;
    }
    .stats-summary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 25px;
        text-align: center;
    }
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 20px;
        margin-top: 15px;
    }
    .stat-item {
        text-align: center;
    }
    .stat-number {
        font-size: 1.8rem;
        font-weight: 700;
        margin-bottom: 5px;
    }
    .stat-label {
        font-size: 0.9rem;
        opacity: 0.9;
    }
    @media (max-width: 768px) {
        .offers-grid {
            grid-template-columns: 1fr;
        }
        .filter-pills {
            justify-content: center;
        }
        .offer-details {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="content-card">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="page-title">
                <i class="fas fa-tags me-3"></i>Stock Offers
            </h1>
            <p class="page-subtitle">Manage and track your stock offers</p>
        </div>
        <a href="{% url 'vendors:submit_offer' %}" class="btn btn-primary">
            <i class="fas fa-plus me-2"></i>New Offer
        </a>
    </div>

    <!-- Stats Summary -->
    <div class="stats-summary">
        <h5><i class="fas fa-chart-bar me-2"></i>Offers Summary</h5>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-number">{{ offers|length }}</div>
                <div class="stat-label">Total</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">{{ offers|length|add:"-1"|default:"0" }}</div>
                <div class="stat-label">Pending</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">{{ offers|length|add:"-2"|default:"0" }}</div>
                <div class="stat-label">Approved</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">{{ offers|length|add:"-3"|default:"0" }}</div>
                <div class="stat-label">Processed</div>
            </div>
        </div>
    </div>

    <!-- Filters -->
    <div class="filters-section">
        <h6><i class="fas fa-filter me-2"></i>Filter Offers</h6>
        <div class="filter-pills">
            <a href="{% url 'vendors:stock_offers' %}" 
               class="filter-pill {% if not request.GET.status %}active{% endif %}">
                All Offers
            </a>
            <a href="?status=pending" 
               class="filter-pill {% if request.GET.status == 'pending' %}active{% endif %}">
                <i class="fas fa-clock me-1"></i>Pending
            </a>
            <a href="?status=approved" 
               class="filter-pill {% if request.GET.status == 'approved' %}active{% endif %}">
                <i class="fas fa-check me-1"></i>Approved
            </a>
            <a href="?status=rejected" 
               class="filter-pill {% if request.GET.status == 'rejected' %}active{% endif %}">
                <i class="fas fa-times me-1"></i>Rejected
            </a>
            <a href="?status=processed" 
               class="filter-pill {% if request.GET.status == 'processed' %}active{% endif %}">
                <i class="fas fa-check-double me-1"></i>Processed
            </a>
        </div>
    </div>

    <!-- Offers Grid -->
    {% if offers %}
        <div class="offers-grid">
            {% for offer in offers %}
                <div class="offer-card">
                    <!-- Book Information -->
                    <div class="book-info">
                        <h4 class="book-title">{{ offer.book.title }}</h4>
                        <div class="book-authors">
                            <i class="fas fa-user me-1"></i>
                            {% for author in offer.book.authors.all %}
                                {{ author.name }}{% if not forloop.last %}, {% endif %}
                            {% empty %}
                                Unknown Author
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Offer Details -->
                    <div class="offer-details">
                        <div class="detail-item">
                            <div class="detail-label">Quantity</div>
                            <div class="detail-value quantity">
                                <i class="fas fa-cubes me-1"></i>{{ offer.quantity }}
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Unit Price</div>
                            <div class="detail-value price">
                                <i class="fas fa-rupee-sign me-1"></i>{{ offer.unit_price }}
                            </div>
                        </div>
                    </div>

                    <!-- Total Amount -->
                    <div class="text-center mb-3">
                        <strong>Total Amount: 
                            <span class="text-success">
                                <i class="fas fa-rupee-sign me-1"></i>{{ offer.total_amount }}
                            </span>
                        </strong>
                    </div>

                    <!-- Dates -->
                    <div class="offer-dates">
                        <div class="date-row">
                            <span class="date-label">
                                <i class="fas fa-calendar-check me-1"></i>Available:
                            </span>
                            <span class="date-value">{{ offer.availability_date|date:"M d, Y" }}</span>
                        </div>
                        <div class="date-row">
                            <span class="date-label">
                                <i class="fas fa-calendar-times me-1"></i>Expires:
                            </span>
                            <span class="date-value">{{ offer.expiry_date|date:"M d, Y" }}</span>
                        </div>
                    </div>

                    <!-- Notes -->
                    {% if offer.notes %}
                        <div class="mb-3">
                            <small class="text-muted">
                                <strong>Notes:</strong> {{ offer.notes|truncatechars:100 }}
                            </small>
                        </div>
                    {% endif %}

                    <!-- Admin Notes -->
                    {% if offer.admin_notes %}
                        <div class="admin-notes">
                            <div class="admin-notes-label">
                                <i class="fas fa-user-shield me-1"></i>Admin Notes:
                            </div>
                            <p class="admin-notes-text">{{ offer.admin_notes }}</p>
                        </div>
                    {% endif %}

                    <!-- Status and Actions -->
                    <div class="status-section">
                        <span class="status-badge status-{{ offer.status }}">
                            {% if offer.status == 'pending' %}
                                <i class="fas fa-clock me-1"></i>
                            {% elif offer.status == 'approved' %}
                                <i class="fas fa-check me-1"></i>
                            {% elif offer.status == 'rejected' %}
                                <i class="fas fa-times me-1"></i>
                            {% elif offer.status == 'processed' %}
                                <i class="fas fa-check-double me-1"></i>
                            {% endif %}
                            {{ offer.get_status_display }}
                        </span>

                        <div class="offer-actions">
                            <a href="#" class="action-btn btn-view" title="View Details">
                                <i class="fas fa-eye"></i>
                            </a>
                            {% if offer.status == 'pending' %}
                                <a href="#" class="action-btn btn-edit" title="Edit Offer">
                                    <i class="fas fa-edit"></i>
                                </a>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Created Date -->
                    <div class="text-center mt-2">
                        <small class="text-muted">
                            <i class="fas fa-calendar-plus me-1"></i>Created: {{ offer.created_at|date:"M d, Y" }}
                        </small>
                    </div>
                </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if offers.has_other_pages %}
            <nav aria-label="Offers pagination">
                <ul class="pagination justify-content-center">
                    {% if offers.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ offers.previous_page_number }}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}">
                                <i class="fas fa-chevron-left"></i>
                            </a>
                        </li>
                    {% endif %}
                    
                    {% for num in offers.paginator.page_range %}
                        {% if offers.number == num %}
                            <li class="page-item active">
                                <span class="page-link">{{ num }}</span>
                            </li>
                        {% elif num > offers.number|add:'-3' and num < offers.number|add:'3' %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ num }}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}">{{ num }}</a>
                            </li>
                        {% endif %}
                    {% endfor %}
                    
                    {% if offers.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ offers.next_page_number }}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}">
                                <i class="fas fa-chevron-right"></i>
                            </a>
                        </li>
                    {% endif %}
                </ul>
            </nav>
        {% endif %}

    {% else %}
        <!-- Empty State -->
        <div class="empty-state">
            <i class="fas fa-tags"></i>
            <h4>No Stock Offers Found</h4>
            {% if request.GET.status %}
                <p>No offers found with status: <strong>{{ request.GET.status|title }}</strong></p>
                <a href="{% url 'vendors:stock_offers' %}" class="btn btn-outline-primary">
                    <i class="fas fa-list me-2"></i>View All Offers
                </a>
            {% else %}
                <p>You haven't submitted any stock offers yet.</p>
                <a href="{% url 'vendors:submit_offer' %}" class="btn btn-primary">
                    <i class="fas fa-plus me-2"></i>Submit Your First Offer
                </a>
            {% endif %}
        </div>
    {% endif %}
</div>

<!-- Offer Details Modal -->
<div class="modal fade" id="offerModal" tabindex="-1" aria-labelledby="offerModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="offerModalLabel">
                    <i class="fas fa-tags me-2"></i>Offer Details
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Modal content will be loaded here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Animate offer cards
    const offerCards = document.querySelectorAll('.offer-card');
    offerCards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(30px)';
        
        setTimeout(() => {
            card.style.transition = 'all 0.6s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100);
    });

    // Stats summary animation
    const statsSection = document.querySelector('.stats-summary');
    if (statsSection) {
        statsSection.style.opacity = '0';
        statsSection.style.transform = 'translateY(-20px)';
        
        setTimeout(() => {
            statsSection.style.transition = 'all 0.8s ease';
            statsSection.style.opacity = '1';
            statsSection.style.transform = 'translateY(0)';
        }, 100);
    }

    // Filter pills animation
    const filterPills = document.querySelectorAll('.filter-pill');
    filterPills.forEach((pill, index) => {
        pill.style.opacity = '0';
        pill.style.transform = 'scale(0.8)';
        
        setTimeout(() => {
            pill.style.transition = 'all 0.4s ease';
            pill.style.opacity = '1';
            pill.style.transform = 'scale(1)';
        }, (index * 50) + 200);
    });

    // View details functionality
    const viewBtns = document.querySelectorAll('.btn-view');
    viewBtns.forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.preventDefault();
            // This would typically load offer details via AJAX
            console.log('View offer details clicked');
        });
    });

    // Edit functionality
    const editBtns = document.querySelectorAll('.btn-edit');
    editBtns.forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.preventDefault();
            // This would typically redirect to edit form
            console.log('Edit offer clicked');
        });
    });
});
</script>
{% endblock %}