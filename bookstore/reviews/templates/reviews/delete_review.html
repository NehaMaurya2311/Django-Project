<!-- reviews/templates/reviews/delete_review.html -->
{% extends 'base.html' %}
{% load static %}

{% block title %}Delete Review - {{ review.book.title }} - {{ block.super }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/bookstore.css' %}">
<style>
.delete-warning {
    background: linear-gradient(135deg, #fff5f5 0%, #fed7d7 100%);
    border: 2px solid #fc8181;
    border-radius: 0.5rem;
    padding: 2rem;
    text-align: center;
    margin-bottom: 2rem;
}

.danger-icon {
    color: #e53e3e;
    font-size: 4rem;
    margin-bottom: 1rem;
}

.review-preview {
    background-color: #f8f9fa;
    border-left: 4px solid #dc3545;
    padding: 1.5rem;
    margin: 1.5rem 0;
}

.rating-stars {
    color: #ffc107;
}

.book-info {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 0.5rem;
    padding: 1.5rem;
    margin-bottom: 2rem;
}
</style>
{% endblock %}

{% block content %}
<div class="container my-5">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'books:home' %}">Home</a></li>
            <li class="breadcrumb-item"><a href="{% url 'books:book_detail' review.book.slug %}">{{ review.book.title|truncatechars:30 }}</a></li>
            <li class="breadcrumb-item"><a href="{% url 'reviews:my_reviews' %}">My Reviews</a></li>
            <li class="breadcrumb-item active">Delete Review</li>
        </ol>
    </nav>

    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Warning Section -->
            <div class="delete-warning">
                <div class="danger-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h3 class="text-danger mb-3">Are you sure you want to delete this review?</h3>
                <p class="mb-0">
                    This action cannot be undone. Your review and all associated data (including helpful votes) will be permanently removed.
                </p>
            </div>

            <!-- Book Information -->
            <div class="book-info">
                <div class="row align-items-center">
                    <div class="col-md-3 text-center">
                        {% if review.book.get_cover_image_url %}
                            <img src="{{ review.book.get_cover_image_url }}" class="img-fluid rounded shadow-sm" 
                                 style="max-height: 120px;" alt="{{ review.book.title }}">
                        {% else %}
                            <div class="bg-white rounded d-flex align-items-center justify-content-center shadow-sm" 
                                 style="height: 120px; width: 80px; margin: 0 auto;">
                                <i class="fas fa-book fa-2x text-muted"></i>
                            </div>
                        {% endif %}
                    </div>
                    <div class="col-md-9">
                        <h4 class="mb-2">{{ review.book.title }}</h4>
                        <p class="text-muted mb-2">
                            by {% for author in review.book.authors.all %}{{ author.name }}{% if not forloop.last %}, {% endif %}{% endfor %}
                        </p>
                        <div class="mb-2">
                            <span class="badge bg-secondary">{{ review.book.category.name }}</span>
                            {% if review.is_verified_purchase %}
                                <span class="badge bg-success">
                                    <i class="fas fa-check-circle me-1"></i>Verified Purchase
                                </span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Review Preview -->
            <div class="card">
                <div class="card-header bg-danger text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-trash me-2"></i>Review to be Deleted
                    </h5>
                </div>
                <div class="card-body">
                    <div class="review-preview">
                        <!-- Rating -->
                        <div class="mb-3">
                            <div class="d-flex align-items-center gap-2">
                                <div>
                                    {% for i in "12345" %}
                                        {% if review.rating >= forloop.counter %}
                                            <i class="fas fa-star rating-stars"></i>
                                        {% else %}
                                            <i class="far fa-star rating-stars"></i>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                                <span class="fw-bold">{{ review.rating }} out of 5 stars</span>
                            </div>
                        </div>

                        <!-- Title -->
                        {% if review.title %}
                            <h6 class="fw-bold mb-2">{{ review.title }}</h6>
                        {% endif %}

                        <!-- Comment -->
                        <p class="mb-3">{{ review.comment|linebreaks }}</p>

                        <!-- Review Metadata -->
                        <div class="row text-muted small">
                            <div class="col-md-6">
                                <div class="mb-1">
                                    <i class="fas fa-calendar me-1"></i>
                                    <strong>Posted:</strong> {{ review.created_at|date:"M d, Y" }}
                                </div>
                                {% if review.updated_at != review.created_at %}
                                <div class="mb-1">
                                    <i class="fas fa-edit me-1"></i>
                                    <strong>Updated:</strong> {{ review.updated_at|date:"M d, Y" }}
                                </div>
                                {% endif %}
                            </div>
                            <div class="col-md-6">
                                <div class="mb-1">
                                    <i class="fas fa-thumbs-up me-1"></i>
                                    <strong>Helpful votes:</strong> {{ review.helpful_count }}
                                </div>
                                <div class="mb-1">
                                    <i class="fas fa-info-circle me-1"></i>
                                    <strong>Status:</strong> 
                                    <span class="badge {% if review.status == 'approved' %}bg-success{% elif review.status == 'pending' %}bg-warning text-dark{% else %}bg-danger{% endif %} ms-1">
                                        {{ review.get_status_display }}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Deletion Impact Warning -->
                    <div class="alert alert-warning">
                        <h6><i class="fas fa-exclamation-triangle me-2"></i>What will be deleted:</h6>
                        <ul class="mb-0 small">
                            <li>Your review text and rating</li>
                            <li>All helpful votes received ({{ review.helpful_count }} votes)</li>
                            {% if review.admin_response %}
                                <li>Any admin responses to this review</li>
                            {% endif %}
                            <li>Review history and timestamps</li>
                        </ul>
                    </div>

                    <!-- Confirmation Form -->
                    <form method="post" class="mt-4" id="deleteForm">
                        {% csrf_token %}
                        
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="confirmDelete" required>
                            <label class="form-check-label fw-bold" for="confirmDelete">
                                I understand this action is permanent and cannot be undone
                            </label>
                        </div>

                        <div class="d-flex justify-content-between align-items-center">
                            <div class="text-muted small">
                                <i class="fas fa-shield-alt me-1"></i>
                                This action is logged for security purposes
                            </div>
                            <div class="d-flex gap-2">
                                <a href="{% url 'reviews:my_reviews' %}" class="btn btn-outline-secondary">
                                    <i class="fas fa-times me-1"></i>Cancel
                                </a>
                                <a href="{% url 'reviews:edit_review' review.id %}" class="btn btn-outline-primary">
                                    <i class="fas fa-edit me-1"></i>Edit Instead
                                </a>
                                <button type="submit" class="btn btn-danger" id="deleteBtn" disabled>
                                    <i class="fas fa-trash me-1"></i>Delete Review
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Alternative Actions -->
            <div class="mt-4 text-center">
                <div class="card bg-light">
                    <div class="card-body">
                        <h6 class="card-title">
                            <i class="fas fa-lightbulb me-2 text-warning"></i>
                            Consider these alternatives
                        </h6>
                        <p class="card-text small mb-3">
                            Instead of deleting, you might want to:
                        </p>
                        <div class="d-flex justify-content-center gap-2 flex-wrap">
                            <a href="{% url 'reviews:edit_review' review.id %}" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-edit me-1"></i>Edit your review
                            </a>
                            <a href="{% url 'books:book_detail' review.book.slug %}" class="btn btn-outline-secondary btn-sm">
                                <i class="fas fa-book me-1"></i>View book page
                            </a>
                            <a href="{% url 'reviews:my_reviews' %}" class="btn btn-outline-info btn-sm">
                                <i class="fas fa-list me-1"></i>View all reviews
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const confirmCheckbox = document.getElementById('confirmDelete');
    const deleteBtn = document.getElementById('deleteBtn');
    const deleteForm = document.getElementById('deleteForm');
    
    // Enable/disable delete button based on confirmation
    confirmCheckbox.addEventListener('change', function() {
        deleteBtn.disabled = !this.checked;
        if (this.checked) {
            deleteBtn.classList.remove('btn-danger');
            deleteBtn.classList.add('btn-danger');
        }
    });
    
    // Handle form submission
    deleteForm.addEventListener('submit', function(e) {
        if (!confirmCheckbox.checked) {
            e.preventDefault();
            alert('Please confirm that you understand this action is permanent.');
            return;
        }
        
        // Double confirmation
        const confirmed = confirm(
            'Are you absolutely sure you want to delete this review? This action cannot be undone.\n\n' +
            'Click OK to permanently delete your review, or Cancel to keep it.'
        );
        
        if (!confirmed) {
            e.preventDefault();
            return;
        }
        
        // Show loading state
        deleteBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Deleting...';
        deleteBtn.disabled = true;
        
        // Add a small delay to show the loading state
        setTimeout(() => {
            // Form will submit normally after this
        }, 500);
    });
    
    // Keyboard shortcut (Escape to cancel)
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            window.location.href = "{% url 'reviews:my_reviews' %}";
        }
    });
});
</script>
{% endblock %}