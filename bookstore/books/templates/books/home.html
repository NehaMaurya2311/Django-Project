{% extends 'base.html' %}
{% load static %}

{% block title %}BookStore - Your Next Favorite Book Awaits{% endblock %}

{% block meta_description %}Discover amazing books across all genres. Fiction, Non-Fiction, Comics, Children Books and more.{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pages/home.css' %}?v=1.0">
{% endblock %}

{% block content %}
    <!-- Hero Section -->
    <section class="hero-section">
        <div class="hero-content">
            <h1>Discover Your Next Favorite Book</h1>
            <p>Explore thousands of books across all genres. From bestsellers to hidden gems, find your perfect read today.</p>
            <a href="{% url 'books:all_books' %}" class="hero-btn">Browse All Books</a>
        </div>
    </section>

    <!-- Books Section with Tabs -->
    <section class="section" id="books-section">
        <div class="container">
            <div class="section-header">
                <h2>Our Book Collection</h2>
                <p>Explore our carefully curated selection of books</p>
            </div>

            <!-- Section Navigation -->
            <div class="book-section-nav">
                <button class="book-section-tab active" data-section="bestseller">
                    <i class="bi bi-award"></i>Bestseller Books
                </button>
                <button class="book-section-tab" data-section="sale">
                    <i class="bi bi-tag"></i>Sale
                </button>
                <button class="book-section-tab" data-section="featured">
                    <i class="bi bi-star"></i>Featured Books
                </button>
            </div>

            <!-- Bestseller Books Section -->
            <div id="bestseller-books" class="section-books active">
                {% if bestseller_books %}
                    <div class="book-grid">
                        {% for book in bestseller_books %}
                        <div class="book-card" data-book-id="{{ book.id }}">
                            <div class="book-image">
                                {% if book.get_cover_image_url %}
                                    <img src="{{ book.get_cover_image_url }}" alt="{{ book.title }}"
                                         onerror="this.onerror=null; this.src='{% static 'images/no-cover.jpg' %}'; this.alt='No cover available';">
                                {% else %}
                                    <img src="{% static 'images/no-cover.jpg' %}" alt="No cover available">
                                {% endif %}
                                <div class="book-badges">
                                    <span class="badge badge-bestseller">
                                        <i class="bi bi-award"></i> BESTSELLER
                                    </span>
                                    {% if book.is_on_sale %}
                                        <span class="badge badge-sale">SALE</span>
                                    {% endif %}
                                </div>
                                {% if not book.in_stock %}
                                    <span class="badge badge-out-of-stock">Out of Stock</span>
                                {% endif %}
                                <div class="book-actions">
                                    <button class="action-btn quick-view-btn" title="Quick View">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="action-btn wishlist-btn" title="Add to Wishlist">
                                        <i class="{% if book.in_wishlist %}fas{% else %}far{% endif %} fa-heart"></i>
                                    </button>
                                    <button class="action-btn share-btn" title="Share"
                                        data-book-title="{{ book.title }}"
                                        data-book-url="{% url 'books:book_detail' book.slug %}">
                                        <i class="fas fa-share-alt"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="book-info">
                                <h3>{{ book.title|truncatechars:40 }}</h3>
                                <p class="author">
                                    <i class="bi bi-person"></i>
                                    {% for author in book.authors.all %}
                                        {{ author.name }}{% if not forloop.last %}, {% endif %}
                                    {% endfor %}
                                </p>
                                <p class="category">{{ book.category.name }}</p>
                                <p class="book-description">{{ book.short_description|truncatechars:80 }}</p>
                                <div class="price-section">
                                    <div>
                                        <span class="price">${{ book.price }}</span>
                                        {% if book.original_price and book.discount_percentage > 0 %}
                                            <span class="price-old">${{ book.original_price }}</span>
                                        {% endif %}
                                    </div>
                                    {% if book.discount_percentage > 0 %}
                                        <span class="discount-percent">{{ book.discount_percentage }}% OFF</span>
                                    {% endif %}
                                </div>
                                <a href="{% url 'books:book_detail' book.slug %}" class="view-details-btn" onclick="event.stopPropagation()">
                                    View Details
                                </a>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-section">
                        <i class="bi bi-award"></i>
                        <h5>No bestseller books available</h5>
                        <p>Admin can mark books as bestsellers from the admin panel.</p>
                    </div>
                {% endif %}
            </div>

            <!-- Sale Books Section -->
            <div id="sale-books" class="section-books">
                {% if sale_books %}
                    <div class="book-grid">
                        {% for book in sale_books %}
                        <div class="book-card" data-book-id="{{ book.id }}">
                            <div class="book-image">
                                {% if book.get_cover_image_url %}
                                    <img src="{{ book.get_cover_image_url }}" alt="{{ book.title }}"
                                         onerror="this.onerror=null; this.src='{% static 'images/no-cover.jpg' %}'; this.alt='No cover available';">
                                {% else %}
                                    <img src="{% static 'images/no-cover.jpg' %}" alt="No cover available">
                                {% endif %}
                                <div class="book-badges">
                                    {% if book.discount_percentage > 0 %}
                                        <span class="badge badge-sale">
                                            {{ book.discount_percentage }}% OFF
                                        </span>
                                    {% else %}
                                        <span class="badge badge-sale">
                                            <i class="bi bi-tag"></i> SALE
                                        </span>
                                    {% endif %}
                                    {% if book.is_bestseller %}
                                        <span class="badge badge-bestseller">BESTSELLER</span>
                                    {% endif %}
                                </div>
                                {% if not book.in_stock %}
                                    <span class="badge badge-out-of-stock">Out of Stock</span>
                                {% endif %}
                                <div class="book-actions">
                                    <button class="action-btn quick-view-btn" title="Quick View">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="action-btn wishlist-btn" title="Add to Wishlist">
                                        <i class="{% if book.in_wishlist %}fas{% else %}far{% endif %} fa-heart"></i>
                                    </button>
                                    <button class="action-btn share-btn" title="Share"
                                        data-book-title="{{ book.title }}"
                                        data-book-url="{% url 'books:book_detail' book.slug %}">
                                        <i class="fas fa-share-alt"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="book-info">
                                <h3>{{ book.title|truncatechars:40 }}</h3>
                                <p class="author">
                                    <i class="bi bi-person"></i>
                                    {% for author in book.authors.all %}
                                        {{ author.name }}{% if not forloop.last %}, {% endif %}
                                    {% endfor %}
                                </p>
                                <p class="category">{{ book.category.name }}</p>
                                <p class="book-description">{{ book.short_description|truncatechars:80 }}</p>
                                <div class="price-section">
                                    <div>
                                        <span class="price">${{ book.price }}</span>
                                        {% if book.original_price and book.discount_percentage > 0 %}
                                            <span class="price-old">${{ book.original_price }}</span>
                                        {% endif %}
                                    </div>
                                    {% if book.discount_percentage > 0 %}
                                        <span class="discount-percent">{{ book.discount_percentage }}% OFF</span>
                                    {% endif %}
                                </div>
                                <a href="{% url 'books:book_detail' book.slug %}" class="view-details-btn" onclick="event.stopPropagation()">
                                    View Details
                                </a>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-section">
                        <i class="bi bi-tag"></i>
                        <h5>No books on sale</h5>
                        <p>Admin can mark books as on sale from the admin panel.</p>
                    </div>
                {% endif %}
            </div>

            <!-- Featured Books Section -->
            <div id="featured-books" class="section-books">
                {% if featured_books %}
                    <div class="book-grid">
                        {% for book in featured_books %}
                        <div class="book-card" data-book-id="{{ book.id }}">
                            <div class="book-image">
                                {% if book.get_cover_image_url %}
                                    <img src="{{ book.get_cover_image_url }}" alt="{{ book.title }}"
                                         onerror="this.onerror=null; this.src='{% static 'images/no-cover.jpg' %}'; this.alt='No cover available';">
                                {% else %}
                                    <img src="{% static 'images/no-cover.jpg' %}" alt="No cover available">
                                {% endif %}
                                <div class="book-badges">
                                    <span class="badge badge-featured">
                                        <i class="bi bi-star"></i> FEATURED
                                    </span>
                                    {% if book.is_bestseller %}
                                        <span class="badge badge-bestseller">BESTSELLER</span>
                                    {% endif %}
                                    {% if book.is_on_sale %}
                                        <span class="badge badge-sale">SALE</span>
                                    {% endif %}
                                </div>
                                {% if not book.in_stock %}
                                    <span class="badge badge-out-of-stock">Out of Stock</span>
                                {% endif %}
                                <div class="book-actions">
                                    <button class="action-btn quick-view-btn" title="Quick View">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="action-btn wishlist-btn" title="Add to Wishlist">
                                        <i class="{% if book.in_wishlist %}fas{% else %}far{% endif %} fa-heart"></i>
                                    </button>
                                    <button class="action-btn share-btn" title="Share"
                                        data-book-title="{{ book.title }}"
                                        data-book-url="{% url 'books:book_detail' book.slug %}">
                                        <i class="fas fa-share-alt"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="book-info">
                                <h3>{{ book.title|truncatechars:40 }}</h3>
                                <p class="author">
                                    <i class="bi bi-person"></i>
                                    {% for author in book.authors.all %}
                                        {{ author.name }}{% if not forloop.last %}, {% endif %}
                                    {% endfor %}
                                </p>
                                <p class="category">{{ book.category.name }}</p>
                                <p class="book-description">{{ book.short_description|truncatechars:80 }}</p>
                                <div class="price-section">
                                    <div>
                                        <span class="price">${{ book.price }}</span>
                                        {% if book.original_price and book.discount_percentage > 0 %}
                                            <span class="price-old">${{ book.original_price }}</span>
                                        {% endif %}
                                    </div>
                                    {% if book.discount_percentage > 0 %}
                                        <span class="discount-percent">{{ book.discount_percentage }}% OFF</span>
                                    {% endif %}
                                </div>
                                <a href="{% url 'books:book_detail' book.slug %}" class="view-details-btn" onclick="event.stopPropagation()">
                                    View Details
                                </a>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-section">
                        <i class="bi bi-star"></i>
                        <h5>No featured books available</h5>
                        <p>Admin can mark books as featured from the admin panel.</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </section>

    <!-- Shop by Category Section -->

    {% if categories %}
    <section class="section section-alt">
        <div class="container">
            <div class="section-header">
                <h2>Shop by Category</h2>
                <p>Browse our extensive collection by your favorite genres</p>
            </div>
            <div class="categories-grid">
                {% for category in categories %}
                <div class="category-card" data-category-slug="{{ category.slug }}">
                    <div class="category-icon">
                        {% if category.image %}
                            <img src="{{ category.image.url }}" alt="{{ category.name }}" class="category-image">
                        {% else %}
                            <div class="default-icon">
                                <i class="fas fa-book"></i>
                            </div>
                        {% endif %}
                    </div>
                    <h3>{{ category.name }}</h3>
                    <div class="book-count">{{ category.books.count }} books</div>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>
    {% endif %}

{% endblock %}

{% block extra_js %}
<!-- JavaScript Context -->
<script>
    // Pass Django context to JavaScript
    window.bookstore = {
        isAuthenticated: {% if user.is_authenticated %}true{% else %}false{% endif %},
        urls: {
            login: "{% url 'accounts:login' %}",
            addToCart: "{% url 'books:add_to_cart' 0 %}",
            toggleWishlist: "{% url 'wishlist:toggle' 0 %}",
            bookDetail: "{% url 'books:book_detail' 'SLUG' %}",
            categoryBooks: "{% url 'books:category_books' 'SLUG' %}"
        },
        csrf_token: "{{ csrf_token }}"
    };
</script>

<!-- Page Specific JavaScript -->
<script src="{% static 'js/pages/home.js' %}"></script>
{% endblock %}